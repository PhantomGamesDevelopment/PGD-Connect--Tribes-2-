<?php
   //RANKS
      $RanksMinPoints[0] = "0";
      $RanksNewRank[0] = "Private";

      $RanksMinPoints[1] = "25";
      $RanksNewRank[1] = "Private Grade I";

      $RanksMinPoints[2] = "50";
      $RanksNewRank[2] = "Private Grade II";
      
      $RanksMinPoints[3] = "100";
      $RanksNewRank[3] = "Private Grade III";

      $RanksMinPoints[4] = "150";
      $RanksNewRank[4] = "Gunnary Private";

      $RanksMinPoints[5] = "200";
      $RanksNewRank[5] = "Gunnary Private Grade I";

      $RanksMinPoints[6] = "250";
      $RanksNewRank[6] = "Gunnary Private Grade II";

      $RanksMinPoints[7] = "300";
      $RanksNewRank[7] = "Gunnary Private Grade III";

      $RanksMinPoints[8] = "400";
      $RanksNewRank[8] = "Corporal";

      $RanksMinPoints[9] = "500";
      $RanksNewRank[9] = "Corporal Grade I";

      $RanksMinPoints[10] = "600";
      $RanksNewRank[10] = "Corporal Grade II";

      $RanksMinPoints[11] = "700";
      $RanksNewRank[11] = "Corporal Grade III";

      $RanksMinPoints[12] = "900";
      $RanksNewRank[12] = "Corporal Grade IV";

      $RanksMinPoints[13] = "1150";
      $RanksNewRank[13] = "Sergeant";

      $RanksMinPoints[14] = "1400";
      $RanksNewRank[14] = "Sergeant Grade I";

      $RanksMinPoints[15] = "1700";
      $RanksNewRank[15] = "Sergeant Grade II";

      $RanksMinPoints[16] = "2000";
      $RanksNewRank[16] = "Sergeant Grade III";

      $RanksMinPoints[17] = "2500";
      $RanksNewRank[17] = "Sergeant Grade IV";

      $RanksMinPoints[18] = "3000";
      $RanksNewRank[18] = "Gunnary Sergeant";

      $RanksMinPoints[19] = "3500";
      $RanksNewRank[19] = "Gunnary Sergeant Grade I";

      $RanksMinPoints[20] = "4000";
      $RanksNewRank[20] = "Gunnary Sergeant Grade II";

      $RanksMinPoints[21] = "4500";
      $RanksNewRank[21] = "Gunnary Sergeant Grade III";

      $RanksMinPoints[22] = "5000";
      $RanksNewRank[22] = "Gunnary Sergeant Grade IV";

      $RanksMinPoints[23] = "6000";
      $RanksNewRank[23] = "Lieutenant";

      $RanksMinPoints[24] = "7000";
      $RanksNewRank[24] = "Lieutenant Grade I";

      $RanksMinPoints[25] = "8000";
      $RanksNewRank[25] = "Lieutenant Grade II";

      $RanksMinPoints[26] = "9000";
      $RanksNewRank[26] = "Lieutenant Grade III";

      $RanksMinPoints[27] = "10000";
      $RanksNewRank[27] = "Lieutenant Grade IV";

      $RanksMinPoints[28] = "12500";
      $RanksNewRank[28] = "Captain";

      $RanksMinPoints[29] = "15000";
      $RanksNewRank[29] = "Captain Grade I";

      $RanksMinPoints[30] = "20000";
      $RanksNewRank[30] = "Captain Grade II";

      $RanksMinPoints[31] = "25000";
      $RanksNewRank[31] = "Captain Grade III";

      $RanksMinPoints[32] = "30000";
      $RanksNewRank[32] = "Major";

      $RanksMinPoints[33] = "37500";
      $RanksNewRank[33] = "Major Grade I";

      $RanksMinPoints[34] = "45000";
      $RanksNewRank[34] = "Major Grade II";

      $RanksMinPoints[35] = "52500";
      $RanksNewRank[35] = "Major Grade III";

      $RanksMinPoints[36] = "60000";
      $RanksNewRank[36] = "Lieutenant Colonel";

      $RanksMinPoints[37] = "70000";
      $RanksNewRank[37] = "Lieutenant Colonel Grade I";

      $RanksMinPoints[38] = "80000";
      $RanksNewRank[38] = "Lieutenant Colonel Grade II";

      $RanksMinPoints[39] = "90000";
      $RanksNewRank[39] = "Lieutenant Colonel Grade III";

      $RanksMinPoints[40] = "100000";
      $RanksNewRank[40] = "Colonel";

      $RanksMinPoints[41] = "125000";
      $RanksNewRank[41] = "Colonel Grade I";

      $RanksMinPoints[42] = "150000";
      $RanksNewRank[42] = "Colonel Grade II";

      $RanksMinPoints[43] = "175000";
      $RanksNewRank[43] = "Brigadier";

      $RanksMinPoints[44] = "200000";
      $RanksNewRank[44] = "Brigadier Grade I";

      $RanksMinPoints[45] = "250000";
      $RanksNewRank[45] = "Brigadier Grade II";

      $RanksMinPoints[46] = "300000";
      $RanksNewRank[46] = "Brigadier General";

      $RanksMinPoints[47] = "350000";
      $RanksNewRank[47] = "Brigadier General I";

      $RanksMinPoints[48] = "425000";
      $RanksNewRank[48] = "Brigadier General II";

      $RanksMinPoints[49] = "500000";
      $RanksNewRank[49] = "General";

      $RanksMinPoints[50] = "575000";
      $RanksNewRank[50] = "2 Star General";

      $RanksMinPoints[51] = "650000";
      $RanksNewRank[51] = "3 Star General";

      $RanksMinPoints[52] = "800000";
      $RanksNewRank[52] = "4 Star General";

      $RanksMinPoints[53] = "1000000";
      $RanksNewRank[53] = "5 Star General";

      $RanksMinPoints[54] = "1250000";
      $RanksNewRank[54] = "Master General";

      $RanksMinPoints[55] = "1500000";
      $RanksNewRank[55] = "Master General I";

      $RanksMinPoints[56] = "1750000";
      $RanksNewRank[56] = "Master General II";

      $RanksMinPoints[57] = "2000000";
      $RanksNewRank[57] = "Commanding General";

      $RanksMinPoints[58] = "2250000";
      $RanksNewRank[58] = "Fleet Commander";

      $RanksMinPoints[59] = "2500000";
      $RanksNewRank[59] = "Commanding Officer";

      $RanksMinPoints[60] = "2750000";
      $RanksNewRank[60] = "Commander";

      $RanksMinPoints[61] = "3000000";
      $RanksNewRank[61] = "Master Commander";
      $RankRankCount = 61;   
      
      $PrestigeName[0] = ""; //none!
      $PrestigeName[1] = "Instructive ";
      $PrestigeName[2] = "Excelling ";
      $PrestigeName[3] = "Champion ";
      $PrestigeName[4] = "Prestigious ";
      $PrestigeName[5] = "Supreme ";
      $PrestigeName[6] = "Glorious ";
      $PrestigeName[7] = "Ultimate ";      
      $PrestigeName[8] = "Shadowing ";
      $PrestigeName[9] = "Phantom ";  
      $PrestigeName[10] = "(*) Phantom ";       
   //
   function getEXP($guid) {
      $myFile = "/home/phantom7/public_html/public/Univ/Data/".$guid."/Ranks/TWM2/Saved.TWMSave"; //sweet jesus :D
      if(is_file($myFile)) {
         $fh = fopen($myFile, 'r');
         $theData = fread($fh, filesize($myFile));
         fclose($fh);
         //exp
         //
         $mEXPStart = strpos($theData, "millionxp = \"") + 13;
         $mexpEnd = strpos($theData,"\";",$mEXPStart); 
         $mexpLen = $mexpEnd - $mEXPStart;
         $mexp = substr($theData, $mEXPStart, $mexpLen);       
         if($mEXPStart <= 13) {
            $mexp = 0;
         }      
         //exp
         $expStart = strpos($theData, "xp = \"", $mexpEnd) + 6;
         $expEnd = strpos($theData,"\";",$expStart); 
         $expLen = $expEnd - $expStart;
         if($expStart == false || $expLen <= 0) {
            $exp = 0;
         }
         else {
            $exp = substr($theData, $expStart, $expLen); 
            if($exp <= 0) {
               $expStart = strpos($theData, "xp = \"") + 6;
               $expEnd = strpos($theData,"\";",$expStart); 
               $expLen = $expEnd - $expStart;  
               $exp = substr($theData, $expStart, $expLen);        
            }
         }
         //
         $exp += ($mexp*1000000);  
         return $exp;
      }    
   }
   
   function getPrestige($guid) {
      $myFile = "/home/phantom7/public_html/public/Univ/Data/".$guid."/Ranks/TWM2/Saved.TWMSave"; //sweet jesus :D
      if(is_file($myFile)) {
         $fh = fopen($myFile, 'r');
         $theData = fread($fh, filesize($myFile));
         fclose($fh);   
         $pStart = strpos($theData, "officer = \"");
         if($pStart <= 0) {
            $prestige = 0;
         }
         else {
            $pStart += 11;
            $pEnd = strpos($theData,"\";",$pStart); 
            $pLen = $pEnd - $pStart;
            $prest = substr($theData, $pStart, $pLen);
            $prestige = $prest; 
         }
         //
         if($prestige > 0) {
            return $prestige;
         }
         else {
            return 0;
         }
      }   
   }
   
   function GetCompletedPrestige($GUID) {
      $Prestige = getPrestige($GUID);  
      
      global $PrestigeName;
      
      for($prst = 1; $prst <= 10; $prst++) {
         if($Prestige >= $prst) {
            echo "<img src=\"Officer".$prst.".png\" alt=\"Officer Level ".$prst."\" title=\"Officer Level ".$prst."\" width=\"20\" height=\"20\" /> "; 
         }
         else {
            if($prst < 10) {
               echo "<img src=\"locked.png\" alt=\"Rank Locked\" title=\"Rank Locked\" width=\"20\" height=\"20\" /> ";
            }
         }
      }      
   }

   function GetCompletedRanks($GUID) {
      $EXP = getEXP($GUID);            
      //
      global $RanksMinPoints; 
      global $RanksNewRank;
      global $RankRankCount;
      for($rnk = 0; $rnk < $RankRankCount; $rnk = $rnk + 1) { 
         if($rnk == 31) { 
            echo "<br>";
         }   
         if($EXP > $RanksMinPoints[$rnk +1]) {      
            $rname = $RanksNewRank[$rnk +1];
            //image output for each rank
            $output = "".str_Replace("Grade", "", $rname).".png";
      	    $output2 = "".str_Replace("IV", "4", $output).".png";
            $output3 = "".str_Replace("III", "3", $output2).".png";
            $output4 = "".str_Replace("II", "2", $output3).".png";
            $output5 = "".str_Replace("I", "1", $output4).".png";      
            $output6 = "".str_Replace(" ", "", $output5).".png";
            $output7 = "".str_Replace(".png", "", $output6).".png";   
            echo "<img src=\"".$output7."\" alt=\"Image For ".$rankf."\" title=\"".$rname." (Awarded at ".$RanksMinPoints[$rnk +1]." EXP)\" width=\"20\" height=\"20\" /> ";         
         }
         else {
            echo "<img src=\"locked.png\" alt=\"Rank Locked\" title=\"Rank Locked\" width=\"20\" height=\"20\" /> ";
         }
      } 
   }  
   
   function getFileField($guid, $field) {
      $myFile = "/home/phantom7/public_html/public/Univ/Data/".$guid."/Ranks/TWM2/Saved.TWMSave"; //sweet jesus :D
      if(is_file($myFile)) {
         $fh = fopen($myFile, 'r');
         $theData = fread($fh, filesize($myFile));
         fclose($fh);     
         //
         $fieldStart = strpos($theData, "".$field." = \"") + (strlen($field)+4);
         $fieldEnd = strpos($theData,"\";",$fieldStart); 
         $fieldLen = $fieldEnd - $fieldStart;
         $fieldValue = substr($theData, $fieldStart, $fieldLen);  
         if($fieldStart <= (strlen($field)+4)) {
            return 0;
         }
         else {
            return $fieldValue;
         }      
      }
      else {
         return 0;
      }   
   }
   
   function GetOtherIcons($guid) {
      //do time...
      echo "<center>";
      $myFile = "/home/phantom7/public_html/public/Univ/Data/".$guid."/Ranks/TWM2/Saved.TWMSave"; //sweet jesus :D
      if(is_file($myFile)) {
         $fh = fopen($myFile, 'r');
         $theData = fread($fh, filesize($myFile));
         fclose($fh);
         //exp
         //
         $totalTime = getFileField($guid, "gameTime"); 
         //get formatted
         if($totalTime <= 0) {
            echo "<img src=\"locked.png\" alt=\"This Icon Is Locked\" title=\"This Icon Is Locked\" width=\"20\" height=\"20\" /> ";
         }
         else {
            $hour = floor($totalTime / 60);
            $min = $totalTime % 60;
            $title = "User has played TWM2 for ".$hour." hours and ".$min." minutes";
            echo "<img src=\"Clock.png\" alt=\"".$title."\" title=\"".$title."\" width=\"20\" height=\"20\" /> ";
         }  
         // 
         $yvex = getFileField($guid, "bossDefeatCountYvex"); 
         if($yvex <= 0) {
            echo "<img src=\"locked.png\" alt=\"This Icon Is Locked\" title=\"This Icon Is Locked\" width=\"20\" height=\"20\" /> ";
         }
         else {
            $title = "Lord Yvex Defeat Count: ".$yvex."";
            echo "<img src=\"Yvex.png\" alt=\"".$title."\" title=\"".$title."\" width=\"20\" height=\"20\" /> ";
         }  
         $ws = getFileField($guid, "bossDefeatCountCnlWindshear"); 
         if($ws <= 0) {
            echo "<img src=\"locked.png\" alt=\"This Icon Is Locked\" title=\"This Icon Is Locked\" width=\"20\" height=\"20\" /> ";
         }
         else {
            $title = "Colonel Windshear Defeat Count: ".$ws."";
            echo "<img src=\"Windshear.png\" alt=\"".$title."\" title=\"".$title."\" width=\"20\" height=\"20\" /> ";
         }         
         // 
         $gol = getFileField($guid, "bossDefeatCountGhostOfLightning"); 
         if($gol <= 0) {
            echo "<img src=\"locked.png\" alt=\"This Icon Is Locked\" title=\"This Icon Is Locked\" width=\"20\" height=\"20\" /> ";
         }
         else {
            $title = "Ghost Of Lightning Defeat Count: ".$gol."";
            echo "<img src=\"GoL.png\" alt=\"".$title."\" title=\"".$title."\" width=\"20\" height=\"20\" /> ";
         }    
         // 
         $vegenor = getFileField($guid, "bossDefeatCountVengenor"); 
         if($vegenor <= 0) {
            echo "<img src=\"locked.png\" alt=\"This Icon Is Locked\" title=\"This Icon Is Locked\" width=\"20\" height=\"20\" /> ";
         }
         else {
            $title = "General Vegenor Defeat Count: ".$vegenor."";
            echo "<img src=\"Vegenor.png\" alt=\"".$title."\" title=\"".$title."\" width=\"20\" height=\"20\" /> ";
         }       
         // 
         $lordrog = getFileField($guid, "bossDefeatCountLordRog"); 
         if($lordrog <= 0) {
            echo "<img src=\"locked.png\" alt=\"This Icon Is Locked\" title=\"This Icon Is Locked\" width=\"20\" height=\"20\" /> ";
         }
         else {
            $title = "Lord Rog Defeat Count: ".$lordrog."";
            echo "<img src=\"LordRog.png\" alt=\"".$title."\" title=\"".$title."\" width=\"20\" height=\"20\" /> ";
         }     
         // 
         $insignia = getFileField($guid, "bossDefeatCountInsignia"); 
         if($insignia <= 0) {
            echo "<img src=\"locked.png\" alt=\"This Icon Is Locked\" title=\"This Icon Is Locked\" width=\"20\" height=\"20\" /> ";
         }
         else {
            $title = "Major Insignia Defeat Count: ".$insignia."";
            echo "<img src=\"Insignia.png\" alt=\"".$title."\" title=\"".$title."\" width=\"20\" height=\"20\" /> ";
         }       
         // 
         $vardison = getFileField($guid, "bossDefeatCountVardison3"); 
         if($vardison <= 0) {
            echo "<img src=\"locked.png\" alt=\"This Icon Is Locked\" title=\"This Icon Is Locked\" width=\"20\" height=\"20\" /> ";
         }
         else {
            $title = "Lord Vardison Defeat Count: ".$vardison."";
            echo "<img src=\"Vardison.png\" alt=\"".$title."\" title=\"".$title."\" width=\"20\" height=\"20\" /> ";
         }    
         // 
         $trevor = getFileField($guid, "bossDefeatCountTrebor"); 
         if($trevor <= 0) {
            echo "<img src=\"locked.png\" alt=\"This Icon Is Locked\" title=\"This Icon Is Locked\" width=\"20\" height=\"20\" /> ";
         }
         else {
            $title = "Lordranius Trevor Defeat Count: ".$trevor."";
            echo "<img src=\"Trevor.png\" alt=\"".$title."\" title=\"".$title."\" width=\"20\" height=\"20\" /> ";
         }     
         // 
         $stormrider = getFileField($guid, "bossDefeatCountStormrider"); 
         if($stormrider <= 0) {
            echo "<img src=\"locked.png\" alt=\"This Icon Is Locked\" title=\"This Icon Is Locked\" width=\"20\" height=\"20\" /> ";
         }
         else {
            $title = "Commander Stormrider Defeat Count: ".$stormrider."";
            echo "<img src=\"Stormrider.png\" alt=\"".$title."\" title=\"".$title."\" width=\"20\" height=\"20\" /> ";
         }       
         // 
         $gof = getFileField($guid, "bossDefeatCountGhostOfFire"); 
         if($gof <= 0) {
            echo "<img src=\"locked.png\" alt=\"This Icon Is Locked\" title=\"This Icon Is Locked\" width=\"20\" height=\"20\" /> ";
         }
         else {
            $title = "Ghost Of Fire Defeat Count: ".$gof."";
            echo "<img src=\"GoF.png\" alt=\"".$title."\" title=\"".$title."\" width=\"20\" height=\"20\" /> ";
         }                                                                          
      }   
      echo "</center>";
   }
?>